redis:
	docker run -p 6379:6379 -v $PWD/data:/data  -d --name redis redis redis-server --appendonly yes

elasticsearch:
	#docker run -d -p 9200:9200 --name=elasticsearch elasticsearch:2.3.5
	#docker run -d -p 9200:9200 --name=elasticsearch elasticsearch
	docker run -d -p 9200:9200 --name=elasticsearch elasticsearch:2.4

logstash:
	agent:
		build: docker build -t logstash_agent logstash_agent/
		run: 
			docker run -d -v ~/data/www/nginx_logs/:/nginx_logs/ -e REDIS_HOST=redis -e NGINX_PATH="\/nginx_logs\/access.log" --link redis:redis --name logstash_agent logstash_agent

	indexer:
		build: docker build -t logstash_indexer logstash_indexer/
		run:
			docker run -d -e REDIS_HOST=redis -e ELASTICSEARCH_HOST=elasticsearch --link redis:redis --link elasticsearch:elasticsearch --name logstash_indexer logstash_indexer

kibana:
	#docker run --link elasticsearch:elasticsearch --name kibana -d -p 5601:5601 kibana
	docker run --link elasticsearch:elasticsearch --name kibana -d -p 5601:5601 kibana:4.6.4

