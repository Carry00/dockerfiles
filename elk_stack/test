redis:
	docker run -p 6379:6379 -v ~/data/redis_data/:/data  -d --name redis redis redis-server --appendonly yes

elasticsearch:
	#docker run -d -p 9200:9200 --name=elasticsearch elasticsearch:2.3.5
	#docker run -d -p 9200:9200 --name=elasticsearch elasticsearch
	#docker run -d -p 9200:9200 --name=elasticsearch elasticsearch:2.4
	docker pull docker.elastic.co/elasticsearch/elasticsearch:5.3.2
	#docker run -d -p 9200:9200 -p 9300:9300 --name elas1 -h elas1 -e cluster.name=lookout-es -e ES_JAVA_OPTS="-Xms512m -Xmx512m" -e xpack.security.enabled=false docker.elastic.co/elasticsearch/elasticsearch:5.3.2

	docker run -d --name elas1 -h elas1 -e cluster.name=lookout-es -e transport.host=0.0.0.0 -e ES_JAVA_OPTS="-Xms1024m -Xmx1024m" -e xpack.security.enabled=false docker.elastic.co/elasticsearch/elasticsearch:5.3.2

	docker run -d --name elas -e transport.host=0.0.0.0 -e discovery.zen.minimum_master_nodes=1 -e ES_JAVA_OPTS="-Xms1g -Xmx1g" docker.elastic.co/elasticsearch/elasticsearch:5.3.2

	
	docker run -d -p 9211:9200 -p 9311:9300 --link elas1 --name elas2 -e cluster.name=lookout-es -e ES_JAVA_OPTS="-Xms512m -Xmx512m" -e xpack.security.enabled=false -e discovery.zen.ping.unicast.hosts=elas1 docker.elastic.co/elasticsearch/elasticsearch:5.3.2


logstash:
	agent:
		build: docker build -t logstash_agent logstash_agent/
		run: 
			docker run -d -v ~/data/www/nginx_logs/:/nginx_logs/ -e REDIS_HOST=redis -e NGINX_PATH="\/nginx_logs\/access.log" --link redis:redis --name logstash_agent logstash_agent

	indexer:
		build: docker build -t logstash_indexer logstash_indexer/
		run:
			docker run -d -e REDIS_HOST=redis -e ELASTICSEARCH_HOST=elasticsearch --link redis:redis --link elasticsearch:elasticsearch --name logstash_indexer logstash_indexer

kibana:
	#docker run --link elasticsearch:elasticsearch --name kibana -d -p 5601:5601 kibana
	#docker run --link elasticsearch:elasticsearch --name kibana -d -p 5601:5601 kibana:4.6.4

	docker run -d --name kibana  --link elas -e ELASTICSEARCH_URL=http://elas:9200 -p 5601:5601 docker.elastic.co/kibana/kibana:5.3.2

